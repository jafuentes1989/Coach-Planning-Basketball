<!--archivo de la pagina de perfil del usuario-->
{% extends "plantilla.html" %}

{% block title %}Perfil{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <label for="profile-image-input" style="cursor: pointer;">
                        <img id="profile-image" alt="Foto de perfil" src="{{ usuario.profile_image or '' }}" class="rounded-circle mb-3" style="width: 250px;">
                    </label>
                    <input type="file" id="profile-image-input" accept="image/*" style="display: none;" onchange="previewImage(event)">
                    <h5 class="card-title">{{ usuario.alias }}</h5>
                    <p class="card-text">{{ usuario.email }}</p>
                    <a href="{{ url_for('perfil.config') }}" class="btn btn-primary">Editar perfil</a>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="card mb-4">
                <div class="card-body">
                    <h1>{{ usuario.nombre }} {{ usuario.apellido }}</h1>
                    <div class="row">
                        <div class="col-sm-6">
                            <p><strong>Nombre:</strong> {{ usuario.nombre }}</p>
                            <p><strong>Apellido:</strong> {{ usuario.apellido }}</p>
                            <p><strong>Nivel:</strong> {{ usuario.nivel }}</p>
                            <p><strong>Temporadas:</strong> {{ usuario.temporadas }}</p>
                        </div>
                        <div class="col-sm-6">
                            <p><strong>Email:</strong> {{ usuario.email }}</p>
                            <p><strong>Club:</strong> {{ usuario.club }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <canvas width="100" height="100"></canvas>
                                <input class="form-control" type="text" value="35" readonly style="width: 60px; margin: 0 auto;">
                            </div>
                            <h5 class="card-title text-danger">Envato Website</h5>
                            <p>Iniciado: 15 de julio</p>
                            <p>Fecha límite: 15 de agosto</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <canvas width="100" height="100"></canvas>
                                <input class="form-control" type="text" value="63" readonly style="width: 60px; margin: 0 auto;">
                            </div>
                            <h5 class="card-title text-info">ThemeForest CMS</h5>
                            <p>Iniciado: 15 de julio</p>
                            <p>Fecha límite: 15 de agosto</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <canvas width="100" height="100"></canvas>
                                <input class="form-control" type="text" value="75" readonly style="width: 60px; margin: 0 auto;">
                            </div>
                            <h5 class="card-title text-success">VectorLab Portfolio</h5>
                            <p>Iniciado: 15 de julio</p>
                            <p>Fecha límite: 15 de agosto</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <canvas width="100" height="100"></canvas>
                                <input class="form-control" type="text" value="50" readonly style="width: 60px; margin: 0 auto;">
                            </div>
                            <h5 class="card-title text-primary">Adobe Muse Template</h5>
                            <p>Iniciado: 15 de julio</p>
                            <p>Fecha límite: 15 de agosto</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Card 5</h5>
                            <p class="card-text">Contenido de la card 5.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Card 6</h5>
                            <p class="card-text">Contenido de la card 6.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Card 7</h5>
                            <p class="card-text">Contenido de la card 7.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Card 8</h5>
                            <p class="card-text">Contenido de la card 8.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <div class="card-body text-center">
                            <h5 class="card-title">Card 9</h5>
                            <p class="card-text">Contenido de la card 9.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        // Previsualizar localmente
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('profile-image').src = e.target.result;
        };
        reader.readAsDataURL(file);

        // Subir al servidor
        const formData = new FormData();
        formData.append('profile_image', file);

        fetch('/perfil/upload_image', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('profile-image').src = data.image_url;
                alert('Imagen subida correctamente.');
            } else {
                alert('Error al subir la imagen.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al subir la imagen.');
        });
    }
}
</script>
{% endblock %}