{% extends "plantilla.html" %}

{% block content %}
    <section class="container-fluid">
        <nav class="navbar">
            <h1>{% block title %}Usuarios{% endblock %}</h1>
            <a href="" class="btn btn-success">Filtrar</a>
        </nav>

        <table class="table">
            <thead>
                <tr>
                    <th class="col">ID</th>
                    <th class="col">alias</th>
                    <th class="col">nombre</th>
                    <th class="col">apellido</th>
                    <th class="col">email</th>
                    <th class="col">nivel</th>
                    <th class="col">temporadas</th>
                    <th class="col">club actual</th>
                </tr>
            </thead>
            <tbody>
                {% for usuario in usuarios | reverse %}
                <tr>
                    <td>
                        <p>{{ usuario.id }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.alias }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.nombre }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.apellido }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.email }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.nivel }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.temporadas }}</p>
                    </td>
                    <td>
                        <p>{{ usuario.club }}</p>
                    </td>
                    <td>
                        {% set estado = estados_seguidos.get(usuario.alias) %}
                        {% if estado is none %}
                            {# No existe relación: se puede enviar solicitud #}
                            <form action="{{ url_for('perfil.seguir', alias=usuario.alias) }}" method="post" class="d-inline">
                                <button type="submit" class="btn btn-info btn-sm">Solicitar</button>
                            </form>
                        {% elif estado == 'pendiente' %}
                            {# Solicitud enviada pero aún no aceptada #}
                            <button type="button" class="btn btn-secondary btn-sm" disabled>Solicitado</button>
                        {% elif estado == 'aceptado' %}
                            {# Relación aceptada: permitir eliminar (dejar de seguir) #}
                            <form action="{{ url_for('perfil.dejar_de_seguir', alias=usuario.alias) }}" method="post" class="d-inline">
                                <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>
{% endblock %}